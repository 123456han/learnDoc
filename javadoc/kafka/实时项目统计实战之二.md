# 实时项目统计实战之二


## 一、概述

* [实时项目统计实战之一](https://blog.csdn.net/qq_27384769/article/details/80220626)

## 二、启动和配置 flum kafka

###  1、Zookeeper

运行 kafka 需要使用 Zookeeper，所以你需要先启动 Zookeeper

```
for host in s201 s202 s203;
do
ssh $host "source /etc/profile;/soft/zk/bin/zkServer.sh start";
done
for host in s201 s202 s203;
do
ssh $host "source /etc/profile;/soft/zk/bin/zkServer.sh status" 
done

```



### 2、启动kafka


启动 kafka
```
bin/kafka-server-start.sh config/server.properties &
bin/kafka-server-stop.sh config/server.properties &
```

通过 list 命令查看创建的 topic:

创建一个叫做“flume”的 topic，它只有一个分区，一个副本。

```
bin/kafka-topics.sh --list --zookeeper s201:2181

```


创建一个消费者:

```
bin/kafka-topics.sh --create --zookeeper s201:2181 --replication-factor 1 --partitions 1 --topic flumeTopic
```

启动 Kafka consumer:

```
bin/kafka-console-consumer.sh --zookeeper s201:2181 --topic flumeTopic --from-beginning
```




### 3、Flume 

启动 Flume
```
bin/flume-ng agent --conf conf --conf-file conf/a1.conf --name a1 -Dflume.root.logger=INFO,console
```

Flume 配置

```
vi conf/a1.conf
```


```

# 定义 agent
a1.sources = src1
a1.channels = ch1
a1.sinks = k1
# 定义 sources
a1.sources.src1.type = exec
a1.sources.src1.command=tail -F /home/centos/log/log
a1.sources.src1.channels=ch1
# 定义 sinks
a1.sinks.k1.type = org.apache.flume.sink.kafka.KafkaSink
a1.sinks.k1.topic = flumeTopic
a1.sinks.k1.brokerList = s201:9092
a1.sinks.k1.batchSize = 20
a1.sinks.k1.requiredAcks = 1
a1.sinks.k1.channel = ch1
# 定义 channels
a1.channels.ch1.type = memory
a1.channels.ch1.capacity = 1000

```


上面 配置文件中提到的默认连接到一个名为 ‘default-flume-topic’ 的 topic" ，

实际上是在 flume-ng-kafka-sink 项目中定义的， 如果需要修改默认名称等属性，可以修改 Constants 类。

flume-ng-kafka-sink/impl/src/main/java/com/polaris/flume/sink/下面的

```
Constants.java
public static final String DEFAULT_TOPIC = "default-flume-topic";
```
