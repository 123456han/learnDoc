## 柔性事务解决方案：TCC（两阶段型、补偿型）

> 实现
* 一个完整的业务活动由一个主业务服务与若干从业务服务组成
* 主业务服务负责发起并完成整个业务活动
* 从业务服务提供TCC型业务操作
* 业务活动管理器控制业务活动的一致性，它登记业务活动中的操作， 并在业务活动提交时确认所有的TCC型操作的confirm操作，在业务活动取消时调用所有TCC型操作的cancel操作

> 成本
* 实现TCC操作的成本
* 业务活动结束时confirm或cancel操作的执行成本
* 业务活动日志成本

> 适用范围
* 强隔离性、严格一致性要求的业务活动
* 适用于执行时间较短的业务（比如处理账户、收费等业务）

![image](https://github.com/csy512889371/learnDoc/blob/master/image/2018/fbs/10.png)


> 用到的服务模式
* TCC操作、幂等操作、可补偿操作、可查询操作

> 方案特点
* 不与具体的服务框架耦合（在RPC架构中通用）
* 位于业务服务层，而非资源层
* 可以灵活选择业务资源的锁定粒度
* TCC里对每个服务资源操作的是本地事务，数据被lock的时间短，可扩展性好（可以说是为独立部署的SOA服务而设计的）

> 行业应用案例
* 支付宝XTS（蚂蚁金融云的分布式事务服务DTS）